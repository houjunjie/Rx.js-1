##Redux你好!
首先要明确说明以下几点雷打不动的事实:

####redux提供的一种解决思路绝对是完美的.

>在我看来就是数据的统一管理,保证数据唯一性,唯一性限制了数据只能单向流,让数据与渲染分离

####redux确实在大部分项目上都表现的很好.

>但是我就是不喜欢,就像不喜欢凤姐一样,就因为她丑,redux的源码是超级优雅的,但是他在和react结合的时候,那写法就一个字:'丑'.

##Redux再见!
###思想上:
####Redux的思想是单向且唯一的数据流,这思想我感觉解决最大的问题就是数据的复用且同步(千万别和我说什么redux提到的数据回滚很方便,实际项目中有个P用)

####问题一:我的state究竟放到哪里?

Redux用store来保存可以说大部分的state,然后从root传递进去,这样的话react的组件state会有2种类型

1. 组件内部自己的状态数据(例如:tab切换的cur,switch的开关状态,大部分为内部自己定义的数据,或者说写死的数据)**::以下称为`state1`**
2. 外部数据用来渲染的数据(例如:list咯,大部分为ajax来的数据)**::以下称为`state2`**

那么问题来了,tab切换有时候会伴随ajax去请求,那么你就需要在action的时候添加上一些组件自己的state1来发送请求,但有些情况是需要2个state1,而且2个state1是来自不同的组件,最差的情况还有这2个组件还TM的不在一个层级上,这时候,如果要发送这个action,你就得跨多个组件去取这2个state1.这种情况下,redux并没有帮到我们什么.

>举个例子:A是最外层的组件,里面有不同游戏的tab(A1),点击A1的话A2的组件会根据A1的游戏ID来获取对应的游戏列表传到A2里,A2里面的也是一个tab(B1)用来切换同个游戏的不同的列表,B2用来展示列表数据,例如B1的tab类型有A1游戏的积分排行榜,俱乐部列表,游戏的任务列表等,那么在切换B1的时候,B2需要发送的action应该是(A1,B1),B2获取A1需要A1=>A2=>B2,获取B1需要B1=>A2=>B2.不同组件的传值就是这么麻烦.

如果你想用redux来解决这问题,那就得把state1当成state2,存到store里.这意味着什么,store里会多出很多类似非必要数据,这个tab当前是在哪个tab上,这个switch是开还是关,存一大堆并不是很必须的东西,重点是,你还得往下传这个值,从root开始,那么就引出了第二个问题

####问题二:数据都是从root进去,每次都刷新?不可变数据?我的天,好多判断!

Redux的机制其实可以多个store,但是并不提倡,为什么呢?因为react的机制是每次有新的state都会执行render,就是说正常情况下,只要你有一个action发出去,都会执行render整个APP(这里说render是因为执行render不一定会刷新,react里面有自我识别算法,判断是否需要刷新),无论你是多小的一个数据改动.其实这是没必要的,避免这种消耗的做法就是用`Immutable.js`,但你还是需要在组件的`shouldComponentUpdate`进行各种判断,来避免多余的消耗,所以单个store更好判断,那么问题一会导致更多的判断.

>看似解决了问题,但在我看来,就像是挖了个坑,然后用shit填满,告诉我补好了,我无言以对.
>
>当然,现在最好的解决方案是高阶组件,用无状态的组件来包装,这样就可以避免无谓的render了

----

###代码风格上:

####多少有那么点规范,让我很不喜欢redux,而且感觉像是为了实现某些功能,添加了好多东西,你可以不懂他的API,但你会一直提心吊胆的使用着.

####痛点一:为什么ajax放在了action里,异步的action,这让我头晕,因为他的实现原理是优雅而又强大的thunk.
设计上的问题,导致的ajax只能放在了action里,因为reducers要保持他是pure-function,所以你只能见鬼的把ajax丢到action里,本来只能是一个纯粹的命令的action,背负上了需要ajax的命运,所以action还不得不得是异步的.故你需要用中间件来处理action的异步,最常用的就是`redux-thunk`(这里就不展开讲了,为了看懂这家伙,我多花了将近1个星期在研究thunk与co和generator),他的作用就在于可以在异步的情况下,把控制权变成同步的,从而让action在发送ajax请求的时候不影响其他action,但在同个action里又是同步的执行.

>其实如果你按着DOME做的话,不太了解action的运行机制并不会有太大问题,但他的确像是个不定时的炸弹,哪知道他什么时候会抽筋,但是他的实现原理真TM屌,最主要就是`applyMiddleware.js`这个文件,一共37行,有效代码13行,精华中的精华.

####痛点二:reducers的设计,就和起变量名一样占用了我大部分的编码时间
首先,这并不能说redux的专属痛点,应该是现在基本上所有的flux都有这毛病,细分的reducers能让代码看起来不那么臃肿,功能分明,但是对于一个迭代速度较快的APP来说,说不定哪天被你拆分的reducers,就需要同步执行了,那你是要合并呢?还是合并呢?所以一个好的reducers设计是前提条件.
>其实我比较懒,我想要可以把数据揉在一起使用.因为事实上拆分state1不是必须的,而是为了让reducers变得可容易维护,才强行把state1拆开.

>遇到过最蛋疼的问题就是,2个列表A和B是各种独立的reducers,有一个列表C中有些数据是依赖列表A和列表B,这时候分布在3个reducers的数据同步就是一个比较蛋疼的问题


####痛点三:react-redux?我能不要他吗
React和Redux其实是2个互不影响的东西,但是要把他们合并在一起使用,那就得用react-redux这个库,他其实也没做什么东西,订阅发布者模式,把redux里的state1绑定到react-redux提个的一个高阶容器里的this.setState,这样每次你的state1一改变就等于重新render了整个APP.我只想把state1传到组件里,为啥我就得多用一个库.反正我有点代码洁癖,我不能忍.

>你肯定会想,不能忍那就自己写个简单的自己用嘛~那么问题又来了,我们还有必要用redux吗?

----

###浪子回头,胜造七级浮屠,立地成佛

当然,我觉得80%的项目都不会是很复杂很复杂的项目,只要考虑好组件的结构(做到公用与精简的平衡),设计好reducers的结构(包括state的设计),花点时间在数据量比较多的地方添加些数据判断来减少渲染,最后加上点忍耐(适应不喜欢的代码),那redux是很好用的,不需要考虑,现阶段绝对是最好的选择.

但是现在仔细想想,redux究竟做了些什么,我能抛弃redux吗?我们一点一点来分析

* 我们先来看看redux的做法,首先是action发送请求(action只是一个命令,带有type和参数的纯对象而已),在reducers中接受到action之后,从store中对对应的数据进行操作,然后存回到store里,而有一点需要注意的是,store的初始化其实也是由reducers生成的.然后用订阅发布模式,把state1传到root里.(大致就是这样,忽略细节)

* 先从数据流来说,在不考虑过多的异步问题前(异步其实是另一个层面的问题,要解决异步问题,应该去看thunk与co和generator),单向且唯一的数据,我们自己也可以做到,不就在全局弄个数据仓库,把所有的state1存到里面嘛!我们可以在组件里ajax取后端的数据,之后用全局store的get与set来存取数据,然后需要注意的是,为了保持数据的一致性,但我们不从root传进去,我们可以在所有需要用到这数据的组件外层用一个高价函数包裹起来,在这个高阶组件上get数据,然后往下传,这样就减少了很多`Immutable`的对比,当然如何让state1改变时通知到高价函数的get来更新数据,就需要订阅发布模式啦(这里我也不展看说了)

* 那如果不用这些所谓的框架呢?只用react会咋样?其实只要设计好结构也能做到上面那几点,当然,唯一的缺点就是数据与渲染没有分离,你的组件里面充斥着数据与数据操作.就上面我们自己实现的简陋的redux来说,全局的数据仓store其实可以放弃掉,用高阶组件来充当局部仓库(就是说高阶组件里2种东西,数据与渲染组件,也可以把高阶组件看作是功能组件),然后就是所谓的发布订阅模式,这个更简单,只要高阶组件的数据变了setState下,重新渲染子组件,把props传下去就可以了,这么做之前说的痛点就变得不痛不痒了,但是数据没有从组件中抽离出来而已.

##总结:

1. redux帮我们创建了一个全局数据仓库,因为数据是从root传进去的所以,保证了唯一性和复用,高阶组件创建的是一个局部的数据仓库,我们需要考虑数据在组件的作用范围,来创建高阶组件,其他的和redux的作用效果是一致的.
2. redux在实现原理上用了很多先进的思想,好比Action异步处理用的thunk,中间件思想, Reducer的纯函数式,结合起来打造了一个良好的调试环境,例如:纯函数式的测试用例很简单,可以在中间件中添加很多功能:日志记录、创建崩溃报告、调用异步接口或者路由等等.高阶组件,你就别想了.
3. redux帮我们比较完美的分离了数据与渲染,这样界面就可以和功能分开写,由2个人来完成.高阶组件,你就别想了

如果只是拿redux在react中解决的问题来看待,那就有点大材小用了,像上面的第二三点,是高阶组件无法轻易做到的,当然如果只是以组件为单位来实现的话,那2者都差不多.但现阶段,我们真的有必要用到redux那么高深的功能吗?
